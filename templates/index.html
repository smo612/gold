<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é‡‘å¹£èˆ‡è£œå“è¨ˆç®—å™¨</title>
    <style>
        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: #f9f9f9;
            padding: 40px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 950px;
        }

        .flex-row {
            display: flex;
            justify-content: space-between;
        }

        .left-col, .right-col {
            width: 48%;
        }

        .potion-block {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .potion-block img {
            width: 48px;
            height: 48px;
            margin-right: 15px;
        }

        .left-col img {
            width: 24px;
            vertical-align: middle;
            margin-right: 5px;
        }

        input[type="number"] {
            width: 70px;
            margin: 2px 5px;
        }

        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        ul {
            padding-left: 20px;
        }

        .result {
            margin-top: 30px;
        }

        .result h3 {
            margin-top: 10px;
        }
    </style>

    <script>
        function updatePotionInputs() {
            const all = document.querySelectorAll('input[name="potions"]');
            const selected = Array.from(all).filter(cb => cb.checked);
            const container = document.getElementById("potion-input-area");
            container.innerHTML = "";
            container.classList.add("hidden");

            all.forEach(cb => cb.disabled = selected.length >= 2 && !cb.checked);

            if (selected.length === 2) {
                const potionInfo = {
                    red:    { name: "ç´…è‰²è—¥æ°´", img: "/static/docs/red.png", defaultPrice: 50 },
                    orange: { name: "æ©˜è‰²è—¥æ°´", img: "/static/docs/orange.png", defaultPrice: 160 },
                    white:  { name: "ç™½è‰²è—¥æ°´", img: "/static/docs/white.png", defaultPrice: 320 },
                    blue:   { name: "è—è‰²è—¥æ°´", img: "/static/docs/blue.png", defaultPrice: 192 },
                    energy: { name: "æ´»åŠ›è—¥æ°´", img: "/static/docs/vigor.png", defaultPrice: 604 }
                };

                selected.forEach(cb => {
                    const key = cb.value;
                    const p = potionInfo[key];
                    const html = `
                        <div class="potion-block">
                            <img src="${p.img}" alt="${p.name}">
                            <div>
                                <strong>${p.name}</strong><br>
                                èµ·å§‹ï¼š<input type="number" name="${key}_start" value="${p.defaultStart || ''}">
                                å‰©é¤˜ï¼š<input type="number" name="${key}_end" value="${p.defaultEnd || ''}"><br>
                                å–®åƒ¹ï¼š<input type="number" name="${key}_price" value="${p.defaultPrice}">
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML("beforeend", html);
                });

                container.classList.remove("hidden");
            }
        }
    </script>
</head>
<body>
<div class="container">
    <h1>ğŸ’° é‡‘å¹£èˆ‡è£œå“è¨ˆç®—å™¨</h1>
    <form method="POST">
        <div class="flex-row">
            <div class="left-col">
                <label>èµ·å§‹é‡‘å¹£ï¼š
                    <input type="number" name="gold_start" value="{{ request.form.gold_start or '' }}" required>
                </label><br>
                <label>ç›®å‰é‡‘å¹£ï¼š
                    <input type="number" name="gold_end" value="{{ request.form.gold_end or '' }}" required>
                </label>
                <hr>
                <p>è«‹é¸æ“‡å…©ç¨®ä½¿ç”¨çš„è—¥æ°´ï¼ˆå¿…é¸å…©é …ï¼‰ï¼š</p>
                {% set selected = request.form.getlist('potions') %}
                <label><input type="checkbox" name="potions" value="red" {% if 'red' in selected %}checked{% endif %} onchange="updatePotionInputs()"><img src="/static/docs/red.png">ç´…è‰²è—¥æ°´</label><br>
                <label><input type="checkbox" name="potions" value="orange" {% if 'orange' in selected %}checked{% endif %} onchange="updatePotionInputs()"><img src="/static/docs/orange.png">æ©˜è‰²è—¥æ°´</label><br>
                <label><input type="checkbox" name="potions" value="white" {% if 'white' in selected %}checked{% endif %} onchange="updatePotionInputs()"><img src="/static/docs/white.png">ç™½è‰²è—¥æ°´</label><br>
                <label><input type="checkbox" name="potions" value="blue" {% if 'blue' in selected %}checked{% endif %} onchange="updatePotionInputs()"><img src="/static/docs/blue.png">è—è‰²è—¥æ°´</label><br>
                <label><input type="checkbox" name="potions" value="energy" {% if 'energy' in selected %}checked{% endif %} onchange="updatePotionInputs()"><img src="/static/docs/vigor.png">æ´»åŠ›è—¥æ°´</label><br>

                <button type="submit">è¨ˆç®—</button>
                <button type="reset">ğŸ”„ é‡è¨­</button>
            </div>

            <div class="right-col" id="potion-input-area">
                <!-- è—¥æ°´è¼¸å…¥å€æœƒç”± JS å‹•æ…‹ç”¢ç”Ÿ -->
            </div>
        </div>
    </form>

    {% if result %}
    <div class="result">
        <h2>ğŸ” è¨ˆç®—çµæœï¼š</h2>
        <ul>
            <li>é‡‘å¹£å¢åŠ ï¼š{{ result.gold_gain }} é‡‘å¹£</li>
            <li>ç¸½æˆæœ¬ï¼š{{ result.total_cost }} é‡‘å¹£</li>
            <li>æ·¨åˆ©ï¼š{{ result.net_profit }} é‡‘å¹£</li>
        </ul>
        <h3>{{ result.status }}</h3>
        <hr>
        <h4>å„è£œå“èŠ±è²»ï¼š</h4>
        <ul>
            {% for p in result.potions %}
                <li>{{ p.name }}ï¼šæ¶ˆè€— {{ p.used }} ç“¶ï¼ŒèŠ±è²» {{ p.cost }} é‡‘å¹£</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
</body>
</html>
